@using HotelKoKoMu_CardRegister.Models;
@model HotelKoKoMu_CardRegister.Models.CardRegisterModel
@{
    ViewBag.Title = "CardRegisterPage";
    Layout = "~/Views/Shared/_CardRegisterLayout.cshtml";
}
<style>
    .modal-footer {
        display: inline-block !important;
    }
</style>

<table class="table-bordered kokomuTable">
    <tbody>
        <tr>
            <td class="td1">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.GuestName</label>
            </td>
            <td class="td2">
                <label id="lblGuestName"></label>
            </td>
            <td class="td1">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.KanaName</label>
            </td>
            <td class="td2">
                <label id="lblKanagataName"></label>
            </td>
        </tr>
        <tr>
            <td class="td1">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.PostalCode</label>
            </td>
            <td class="td2">
                <label id="lblPostalCode"></label>
            </td>
            <td class="td1">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.PhoneNo</label>
            </td>
            <td class="td2">
                <label id="lblPhoneNo"></label>
            </td>
        </tr>
        <tr>
            <td rowspan="2">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.Address</label>
            </td>
            <td colspan="3">
                <label id="lblAddress1"></label>
            </td>


        </tr>
        <tr>
            <td colspan="3">
                <label id="lblAddress2"></label>
            </td>
        </tr>
        <tr>
            <td class="td1">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.WorkPlace</label>
            </td>
            <td colspan="3">
                <label id="lblWorkPlace"></label>
            </td>
        </tr>
        <tr>
            <td class="td1">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.Nationality</label>
            </td>
            <td class="td2">
                <label id="lblNationality"></label>
            </td>
            <td class="td1">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.Passport</label>
            </td>
            <td class="td2">
                <label id="lblPassport"></label>
            </td>
        </tr>
    </tbody>
</table>

<table class="kokomuTable rowspace">
    <tbody>
        <tr>
            <td class="td1" style="border-right:hidden;">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.ArrivalDate</label>
            </td>
            <td class="td2" style="border-right:hidden;">
                <label id="lblArrivalDate"></label>
            </td>
            <td class="td1" style="border-right:hidden;">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.DepartureDate</label>
            </td>
            <td class="td2">
                <label id="lblDepartureDate"></label>
            </td>
        </tr>
    </tbody>
</table>
<table class="kokomuTable">
    <tbody>
        <tr>
            <td class="td1">
                <label>@HotelKoKoMu_CardRegister.Resources.Resources.Sign</label>
            </td>

            <td colspan="3">
                <label id="lblSign"></label>
            </td>

        </tr>
    </tbody>

</table>
<div class="col-md-4 offset-md-4">
    <button class="clsfinish" id="btnfinish">@HotelKoKoMu_CardRegister.Resources.Resources.Complete</button>
</div>


<div id="CardRegisterModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-xl">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="background-color:#1b5696;color:white;">
                <h4 class="modal-title">Card Registration</h4>
                <button type="button" class="close" data-dismiss="modal" style="color:white;">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" id="divCanvas">
                        <label id="lblcanvas"></label><br />
                        <canvas id="csvRegister" width="760" height="130"></canvas>
                    </div>
                </div>
                <div class="row d-none" id="divName">
                    <div class="col-md-12">
                        <label id="lbltext"></label><br />
                        <textarea id="txtRegister" rows="5"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-md-4">
                        <button class="clsRedo" id="btnRedo">@HotelKoKoMu_CardRegister.Resources.Resources.Redo</button>
                    </div>
                    <div class="col-md-4">
                        <button class="clsConfirm" id="btnConfirm">@HotelKoKoMu_CardRegister.Resources.Resources.Confirm</button>
                    </div>
                    <div class="col-md-4">
                        <button class="clsInputKeyboard" id="btnInputKeyboard">@HotelKoKoMu_CardRegister.Resources.Resources.Insertkeyboard</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

@section Scripts
{

    <script type="text/javascript">

        var guestname = '';
        var kananame = '';
        var phoneno = '';
        var address1 = '';
        var address2 = '';
        var postalcode = '';
        var passport = '';
        var nationality = '';
        var sign = '';
        var workplace = '';

        var canvas = document.getElementById('csvRegister'),
            ctx = canvas.getContext('2d'),
            moveflg = 0,
            Xpoint,
            Ypoint;

        //初期値（サイズ、色、アルファ値）の決定
        var defSize = 7,
            defColor = "#555";

        // キャンバスを白色に塗る
        ctx.fillStyle = 'rgb(255,255,255)'; 

        // ストレージの初期化
        //var myStorage = localStorage;
        //window.onload = initLocalStorage();

        // Event handler to resize the canvas when the document view is changed
        window.addEventListener('resize', resizeCanvas, false);

        // PC対応
        canvas.addEventListener('mousedown', startPoint, false);
        canvas.addEventListener('mousemove', movePoint, false);
        canvas.addEventListener('mouseup', endPoint, false);

        // スマホ対応
        canvas.addEventListener('touchstart', startPoint, false);
        canvas.addEventListener('touchmove', movePoint, false);
        canvas.addEventListener('touchend', endPoint, false);

      

        function startPoint(e) {
            e.preventDefault();
            ctx.beginPath();
            Xpoint = e.layerX;
            Ypoint = e.layerY;
            ctx.moveTo(Xpoint, Ypoint);
        }

        function resizeCanvas() {
            var modalWidth = $(".modal-dialog").css('max-width');
            canvas.width = parseInt(modalWidth.replace('px', '')) - 35;
        }

        resizeCanvas();

        function movePoint(e) {
            if (e.buttons === 1 || e.witch === 1 || e.type == 'touchmove') {
                Xpoint = e.layerX;
                Ypoint = e.layerY;
                moveflg = 1;
                ctx.lineTo(Xpoint, Ypoint);
                ctx.lineCap = "round";
                ctx.lineWidth = defSize * 2;
                ctx.strokeStyle = defColor;
                ctx.stroke();
            }
        }

        function endPoint(e) {
            if (moveflg === 0) {
                ctx.lineTo(Xpoint - 1, Ypoint - 1);
                ctx.lineCap = "round";
                ctx.lineWidth = defSize * 2;
                ctx.strokeStyle = defColor;
                ctx.stroke();
            }
            moveflg = 0;
        }

        function resetCanvas() {
            ctx.clearRect(0, 0, ctx.canvas.clientWidth, ctx.canvas.clientHeight);
            ctx.fillStyle = 'rgb(255,255,255)';
        }

        $(document).ready(function () {

            $("#btnInputKeyboard").click(function () {
                $("#divCanvas").addClass('d-none');
                $("#divName").removeClass('d-none');
            });

            $("#btnRedo").click(function () {
                $("#txtRegister").val('');
            });

            $("#btnConfirm").click(function () {
                ConfirmData();
            })


            $(".kokomuTable td").click(function () {
                var text = $(this).find("label").attr("id");
                if (text == "lblGuestName") {

                    $("#lblcanvas").text('@HotelKoKoMu_CardRegister.Resources.Resources.GuestName_Kanji');
                    $("#lbltext").text('@HotelKoKoMu_CardRegister.Resources.Resources.GuestName_Kanji');
                    guestname = '@HotelKoKoMu_CardRegister.Resources.Resources.GuestName_Kanji';
                    ModalShow();

                }

                if (text == "lblKanagataName") {

                    $("#lblcanvas").text('@HotelKoKoMu_CardRegister.Resources.Resources.GuestName_Kana');
                    $("#lbltext").text('@HotelKoKoMu_CardRegister.Resources.Resources.GuestName_Kana');
                    kananame = '@HotelKoKoMu_CardRegister.Resources.Resources.GuestName_Kana';
                    ModalShow();
                }

                if (text == "lblPostalCode") {

                    $("#lblcanvas").text('@HotelKoKoMu_CardRegister.Resources.Resources.PostalCode');
                    $("#lbltext").text('@HotelKoKoMu_CardRegister.Resources.Resources.PostalCode');
                    postalcode = '@HotelKoKoMu_CardRegister.Resources.Resources.PostalCode';
                    ModalShow();
                }

                if (text == "lblPhoneNo") {

                    $("#lblcanvas").text('@HotelKoKoMu_CardRegister.Resources.Resources.PhoneNo');
                    $("#lbltext").text('@HotelKoKoMu_CardRegister.Resources.Resources.PhoneNo');
                    phoneno = '@HotelKoKoMu_CardRegister.Resources.Resources.PhoneNo';
                    ModalShow();
                }

                if (text == "lblAddress1") {

                    $("#lblcanvas").text('@HotelKoKoMu_CardRegister.Resources.Resources.Address1');
                    $("#lbltext").text('@HotelKoKoMu_CardRegister.Resources.Resources.Address1');
                    address1 = '@HotelKoKoMu_CardRegister.Resources.Resources.Address1';
                    ModalShow();
                }

                if (text == "lblAddress2") {

                    $("#lblcanvas").text('@HotelKoKoMu_CardRegister.Resources.Resources.Address2');
                    $("#lbltext").text('@HotelKoKoMu_CardRegister.Resources.Resources.Address2');
                    address2 = '@HotelKoKoMu_CardRegister.Resources.Resources.Address2';
                    ModalShow();
                }

                if (text == "lblWorkPlace") {

                    $("#lblcanvas").text('@HotelKoKoMu_CardRegister.Resources.Resources.WorkPlace');
                    $("#lbltext").text('@HotelKoKoMu_CardRegister.Resources.Resources.WorkPlace');
                    workplace = '@HotelKoKoMu_CardRegister.Resources.Resources.WorkPlace';
                    ModalShow();
                }

                if (text == "lblNationality") {

                    $("#lblcanvas").text('@HotelKoKoMu_CardRegister.Resources.Resources.Nationality');
                    $("#lbltext").text('@HotelKoKoMu_CardRegister.Resources.Resources.Nationality');
                    nationality = '@HotelKoKoMu_CardRegister.Resources.Resources.Nationality';
                    ModalShow();
                }

                if (text == "lblPassport") {

                    $("#lblcanvas").text('@HotelKoKoMu_CardRegister.Resources.Resources.PassportNo');
                    $("#lbltext").text('@HotelKoKoMu_CardRegister.Resources.Resources.PassportNo');
                    passport = '@HotelKoKoMu_CardRegister.Resources.Resources.PassportNo';
                    ModalShow();
                }

                if (text == "lblSign") {

                    $("#lblcanvas").text('@HotelKoKoMu_CardRegister.Resources.Resources.Sign');
                    $("#lbltext").text('@HotelKoKoMu_CardRegister.Resources.Resources.Sign');
                    sign = '@HotelKoKoMu_CardRegister.Resources.Resources.Sign';
                    ModalShow();
                    
                }

            });

            function ModalShow() {
                $("#divCanvas").removeClass('d-none');
                $("#divName").addClass('d-none');
                $('#CardRegisterModal').modal('show');
            }

            function ConfirmData() {

                if ($("#lblcanvas").text() == guestname ||
                    $("#lbltext").text() == guestname) {

                    $("#lblGuestName").text($("#txtRegister").val());
                    $('#CardRegisterModal').modal('hide');
                    $("#txtRegister").val('');
                }

                if ($("#lblcanvas").text() == kananame ||
                    $("#lbltext").text() == kananame) {

                     $("#lblKanagataName").text($("#txtRegister").val());
                     $('#CardRegisterModal').modal('hide');
                     $("#txtRegister").val('');
                }

                if ($("#lblcanvas").text() == postalcode ||
                    $("#lbltext").text() == postalcode) {

                    $("#lblPostalCode").text($("#txtRegister").val());
                    $('#CardRegisterModal').modal('hide');
                    $("#txtRegister").val('');
                }

                if ($("#lblcanvas").text() == phoneno ||
                    $("#lbltext").text() == phoneno) {

                    $("#lblPhoneNo").text($("#txtRegister").val());
                    $('#CardRegisterModal').modal('hide');
                    $("#txtRegister").val('');
                }

                if ($("#lblcanvas").text() == address1 ||
                    $("#lbltext").text() == address1) {

                    $("#lblAddress1").text($("#txtRegister").val());
                    $('#CardRegisterModal').modal('hide');
                    $("#txtRegister").val('');
                }

                if ($("#lblcanvas").text() == address2 ||
                    $("#lbltext").text() == address2) {

                    $("#lblAddress2").text($("#txtRegister").val());
                    $('#CardRegisterModal').modal('hide');
                    $("#txtRegister").val('');
                }

                if ($("#lblcanvas").text() == workplace ||
                    $("#lbltext").text() == workplace) {

                    $("#lblWorkPlace").text($("#txtRegister").val());
                    $('#CardRegisterModal').modal('hide');
                    $("#txtRegister").val('');
                }

                if ($("#lblcanvas").text() == nationality ||
                    $("#lbltext").text() == nationality) {

                    $("#lblNationality").text($("#txtRegister").val());
                    $('#CardRegisterModal').modal('hide');
                    $("#txtRegister").val('');
                }

                if ($("#lblcanvas").text() == passport ||
                    $("#lbltext").text() == passport) {

                    $("#lblPassport").text($("#txtRegister").val());
                    $('#CardRegisterModal').modal('hide');
                    $("#txtRegister").val('');
                }

                if ($("#lblcanvas").text() == sign ||
                    $("#lbltext").text() == sign) {

                    $("#lblSign").text($("#txtRegister").val());
                    $('#CardRegisterModal').modal('hide');
                    $("#txtRegister").val('');
                }
            }
        });
    </script>
}






